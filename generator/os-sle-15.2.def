BASE_IMAGE([suse/sle15:15.2])

define(_OBS_REGISTRY_HOST,[registry.suse.com])
define(_OBS_REGISTRY_NAMESPACE,[suse/sles/15.2])

define([_BUILD_SETUP],[
RUN mv /etc/zypp /etc/zypp.save
ADD SCC/sles15-sp2.tar.gz /etc/zypp
RUN --mount=type=secret,id=scc_credentials \
  cp /run/secrets/scc_credentials /etc/zypp/credentials.d/SCCcredentials

# Work around https://github.com/openSUSE/obs-build/issues/487
RUN zypper install -y sles-release
])
define(_BUILD_CLEANUP,[
RUN rm -rf /etc/zypp
RUN mv /etc/zypp.save /etc/zypp
])
